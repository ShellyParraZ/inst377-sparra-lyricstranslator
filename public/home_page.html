<html>
  <head>
    <title>INST 377 Final Project</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body style="background-color: rgb(157, 188, 226)">
    <header>
      <h1>Lyrics Translator</h1>
      <!--Navigation Section-->
      <nav id="nav_bar">
        <ul>
          <li><a href="home_page.html">Home</a></li>
          <li><a href="full_lyrics.html">Full Lyrics</a></li>
          <li><a href="about_page.html">About</a></li>
        </ul>
      </nav>
    </header>
    <!--Line Separator-->
    <hr />
    <br />
    <!--Song Details Section-->
    <h2 id="h2_HP">Song Details</h2>
    <form id="songForm">
      <input type="text" id="song_title" placeholder="Song Title" required />
      <br />
      <input type="text" id="artist" placeholder="Artist" required />
      <br />
      <select id="original_language" name="original_language" required>
        <option value="" disabled selected>Original Language</option>
      </select>
      <select id="target_language" name="target_language" required>
        <option value="" disabled selected>Target Language</option>
      </select>
      <br />
      <div class="buttons">
        <button id="translateButton" type="submit">Translate</button>
        <button id="restartButton" type="button">Restart</button>
      </div>
    </form>
    <!--Lyrics Preview Section-->
    <br />
    <div class="lyricsPreview">
      <h2 id="h2_HP">Preview</h2>
      <div class="lyric_boxes">
        <div class="original_lyrics">
          <h4>Original</h4>
          <pre></pre>
        </div>
        <div class="translated_lyrics">
          <h4>Translated</h4>
          <pre></pre>
        </div>
      </div>
    </div>
    <!--Full Lyrics Button-->
    <button id="fullLyricsButton" type="button">View Full Lyrics</button>
  </body>
  <!--Javascript Section-->
  <script>
    window.onload = () => {
      // variables
      const original_language = document.getElementById("original_language");
      const target_language = document.getElementById("target_language");
      const originalBox = document.querySelector(".original_lyrics pre");
      const translatedBox = document.querySelector(".translated_lyrics pre");

      // hardcoded languages for target and original dropdown menus
      const sourceLangDeepL = [
        { code: "AR", name: "Arabic" },
        { code: "BG", name: "Bulgarian" },
        { code: "CS", name: "Czech" },
        { code: "DA", name: "Danish" },
        { code: "DE", name: "German" },
        { code: "EL", name: "Greek" },
        { code: "EN", name: "English" },
        { code: "ES", name: "Spanish" },
        { code: "ET", name: "Estonian" },
        { code: "FI", name: "Finnish" },
        { code: "FR", name: "French" },
        { code: "HE", name: "Hebrew" },
        { code: "HU", name: "Hungarian" },
        { code: "ID", name: "Indonesian" },
        { code: "IT", name: "Italian" },
        { code: "JA", name: "Japanese" },
        { code: "KO", name: "Korean" },
        { code: "LT", name: "Lithuanian" },
        { code: "LV", name: "Latvian" },
        { code: "NB", name: "Norwegian Bokmål" },
        { code: "NL", name: "Dutch" },
        { code: "PL", name: "Polish" },
        { code: "PT", name: "Portuguese" },
        { code: "RO", name: "Romanian" },
        { code: "RU", name: "Russian" },
        { code: "SK", name: "Slovak" },
        { code: "SL", name: "Slovenian" },
        { code: "SV", name: "Swedish" },
        { code: "TH", name: "Thai" },
        { code: "TR", name: "Turkish" },
        { code: "UK", name: "Ukrainian" },
        { code: "VI", name: "Vietnamese" },
        { code: "ZH", name: "Chinese" },
      ];

      const targetLangDeepL = [
        { code: "AR", name: "Arabic" },
        { code: "BG", name: "Bulgarian" },
        { code: "CS", name: "Czech" },
        { code: "DA", name: "Danish" },
        { code: "DE", name: "German" },
        { code: "EL", name: "Greek" },
        { code: "EN", name: "English" },
        { code: "EN-GB", name: "English (British)" },
        { code: "EN-US", name: "English (American)" },
        { code: "ES", name: "Spanish" },
        { code: "ES-419", name: "Spanish (Latin American)" },
        { code: "ET", name: "Estonian" },
        { code: "FI", name: "Finnish" },
        { code: "FR", name: "French" },
        { code: "HE", name: "Hebrew" },
        { code: "HU", name: "Hungarian" },
        { code: "ID", name: "Indonesian" },
        { code: "IT", name: "Italian" },
        { code: "JA", name: "Japanese" },
        { code: "KO", name: "Korean" },
        { code: "LT", name: "Lithuanian" },
        { code: "LV", name: "Latvian" },
        { code: "NB", name: "Norwegian Bokmål" },
        { code: "NL", name: "Dutch" },
        { code: "PL", name: "Polish" },
        { code: "PT", name: "Portuguese" },
        { code: "PT-BR", name: "Portuguese (Brazilian)" },
        { code: "PT-PT", name: "Portuguese (all variants except Brazilian)" },
        { code: "RO", name: "Romanian" },
        { code: "RU", name: "Russian" },
        { code: "SK", name: "Slovak" },
        { code: "SL", name: "Slovenian" },
        { code: "SV", name: "Swedish" },
        { code: "TH", name: "Thai" },
        { code: "TR", name: "Turkish" },
        { code: "UK", name: "Ukrainian" },
        { code: "VI", name: "Vietnamese" },
        { code: "ZH", name: "Chinese" },
        { code: "ZH-HANS", name: "Chinese (simplified)" },
        { code: "ZH-HANT", name: "Chinese (traditional)" },
      ];

      // adding the languages to the original_language and target_language dropdown menus
      function populateDropdowns() {
        sourceLangDeepL.forEach((lang) => {
          const option = document.createElement("option");
          option.value = lang.code;
          option.textContent = lang.name;
          original_language.appendChild(option);
        });

        targetLangDeepL.forEach((lang) => {
          const option = document.createElement("option");
          option.value = lang.code;
          option.textContent = lang.name;
          target_language.appendChild(option);
        });
      }
      populateDropdowns();

      // USER: clicks Translate button
      // COLLECT all the details
      document
        .getElementById("songForm")
        .addEventListener("submit", async (details) => {
          details.preventDefault(); // stop page from refreshing

          const title = document.getElementById("song_title").value;
          const artist = document.getElementById("artist").value;
          const originalLang = original_language.value;
          const targetLang = target_language.value;

          console.log({ title, artist, originalLang, targetLang });

          // temporary loading messages
          originalBox.textContent = "lyrics are loading...";
          translatedBox.textContent = "lyrics are translating...";

          // fetching original lyrics from Lyrics.oh API
          const originalLyrics = await getLyrics(artist, title);
          originalBox.textContent = originalLyrics;

          // FETCHING TRANSLATE for lyrics
          try {
            const response = await fetch("/api", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                title,
                artist,
                originalLang,
                targetLang,
                originalLyrics,
              }),
            });

            const data = await response.json();

            if (!response.ok) {
              throw new Error(data.error || "Translation failed");
            }

            translatedBox.textContent = data.translated_lyrics;

            localStorage.setItem("fullLyrics", data.original_lyrics);
            localStorage.setItem("translatedLyrics", data.translated_lyrics);
            localStorage.setItem(
              "originalLangName",
              original_language.options[original_language.selectedIndex].text
            );

            localStorage.setItem(
              "targetLangName",
              target_language.options[target_language.selectedIndex].text
            );
          } catch (translateErr) {
            console.error(translateErr);
            translatedBox.textContent = "Error translating lyrics.";
          }
        });

      // RESTARTS THE FORM THROUGH RESTART BUTTON
      document.getElementById("restartButton").addEventListener("click", () => {
        // clears text inputs
        document.getElementById("song_title").value = "";
        document.getElementById("artist").value = "";

        // resets dropdown menus
        document.getElementById("original_language").selectedIndex = 0;
        document.getElementById("target_language").selectedIndex = 0;

        // clears the preview text
        originalBox.textContent = "";
        translatedBox.textContent = "";

        console.log("Form Restarted");
      });

      // FULL LYRICS BUTTON: opens the full_lyrics.html page and shows the lyrics
      document
        .getElementById("fullLyricsButton")
        .addEventListener("click", () => {
          const originalLyrics = originalBox.textContent;
          const translatedLyrics = translatedBox.textContent;

          // Provides an alert if there are no lyrics to display
          if (!originalLyrics) {
            alert("!!!No lyrics to display!!!");
            return;
          }

          // Saves the lyrics so the next page can read them
          localStorage.setItem("fullLyrics", originalLyrics);
          localStorage.setItem("translatedLyrics", translatedLyrics);

          // Goes to the full lyrics page
          window.location.href = "full_lyrics.html";
          console.log("Full lyrics button clicked.");
        });
    };

    // fetching the lyrics
    async function getLyrics(artist, title) {
      try {
        const response = await fetch(
          `https://api.lyrics.ovh/v1/${artist}/${title}`
        );
        const data = await response.json();

        if (data.lyrics) {
          return data.lyrics;
        } else {
          return "Lyrics not found";
        }
      } catch (fetch_lyrics_error) {
        console.error("Error fetching lyrics:", fetch_lyrics_error);
        return "Error fetching lyrics";
      }
    }
  </script>
</html>
